#!/bin/bash
# 恶意 IP 段封禁脚本（清理版 - 保留云服务商/IDC，移除家庭宽带）
# 用法: chmod +x block_ips.sh && ./block_ips.sh

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "=========================================="
echo "      恶意 IP 段封禁脚本（清理版）"
echo "=========================================="

# ========== 自动获取服务器所有 IP（支持站群服务器）==========
echo ""
echo "正在获取服务器所有 IP..."

# 获取服务器上绑定的所有 IP（支持200+个IP的站群服务器）
SERVER_IPS=$(ip addr show 2>/dev/null | grep -oP 'inet \K[\d.]+' | grep -v '^127\.' | sort -u)
SERVER_IP_COUNT=$(echo "$SERVER_IPS" | wc -l)

echo -e "${GREEN}检测到服务器共有 $SERVER_IP_COUNT 个 IP 地址${NC}"

# 如果 IP 数量超过 10 个，只显示前 5 个和后 5 个
if [[ $SERVER_IP_COUNT -gt 10 ]]; then
    echo "前 5 个: $(echo "$SERVER_IPS" | head -5 | tr '\n' ' ')"
    echo "后 5 个: $(echo "$SERVER_IPS" | tail -5 | tr '\n' ' ')"
    echo "..."
else
    echo "IP 列表: $SERVER_IPS"
fi

# ========== 白名单 IP（优先放行，不会被封禁）==========
# 在这里添加你的 IP，格式：单个IP 或 CIDR
WHITELIST_IPS=(
    "124.13.164.0/24"     # 马来西亚 IP
    "116.102.181.220"     # 你的 IP
    "203.168.241.16"
    "182.239.114.239"
    "115.135.30.121"
    "127.0.0.1"           # 本机回环
)

# 自动添加服务器所有 IP 到白名单
for ip in $SERVER_IPS; do
    WHITELIST_IPS+=("$ip")
done
echo -e "${GREEN}[自动添加] 已将服务器 $SERVER_IP_COUNT 个 IP 加入白名单${NC}"

# 要封禁的 IP 段（只封云服务商/IDC，不封家庭宽带）
BLOCK_RANGES=(
    
    # ========== 微软 Azure 云（全封）==========
    "4.0.0.0/8"           # 整个 4.x.x.x
    "13.0.0.0/8"          # 整个 13.x.x.x
    "20.0.0.0/8"          # 整个 20.x.x.x
    "40.0.0.0/8"          # 整个 40.x.x.x
    "48.0.0.0/8"          # 整个 48.x.x.x
    "52.0.0.0/8"          # 整个 52.x.x.x
    "23.0.0.0/8"          # 整个 23.x.x.x
    "104.215.0.0/16"      # Azure
    
    # ========== 腾讯云（全封）==========
    "43.128.0.0/10"       # 43.128-43.191
    "49.51.0.0/16"        # 49.51.x.x
    "49.232.0.0/14"       # 49.232-49.235
    "81.68.0.0/14"        # 81.68-81.71
    "82.156.0.0/15"       # 82.156-82.157
    "94.191.0.0/17"       # 94.191.0-127
    "101.32.0.0/14"       # 101.32-101.35
    "106.52.0.0/14"       # 106.52-106.55
    "111.229.0.0/16"      # 111.229.x.x
    "111.230.0.0/15"      # 111.230-111.231
    "115.159.0.0/16"      # 115.159.x.x
    "118.24.0.0/15"       # 118.24-118.25
    "118.89.0.0/16"       # 118.89.x.x
    "118.126.0.0/16"      # 118.126.x.x
    "119.28.0.0/15"       # 119.28-119.29
    "119.45.0.0/16"       # 119.45.x.x
    "121.4.0.0/15"        # 121.4-121.5
    "121.51.0.0/16"       # 121.51.x.x
    "122.51.0.0/16"       # 122.51.x.x
    "122.152.0.0/16"      # 122.152.x.x
    "123.206.0.0/15"      # 123.206-123.207
    "124.156.0.0/15"      # 124.156-124.157
    "124.220.0.0/14"      # 124.220-124.223
    "129.28.0.0/16"       # 129.28.x.x
    "129.204.0.0/16"      # 129.204.x.x
    "129.226.0.0/16"      # 129.226.x.x
    "132.232.0.0/16"      # 132.232.x.x
    "134.175.0.0/16"      # 134.175.x.x
    "139.155.0.0/16"      # 139.155.x.x
    "139.186.0.0/16"      # 139.186.x.x
    "139.199.0.0/16"      # 139.199.x.x
    "140.143.0.0/16"      # 140.143.x.x
    "148.70.0.0/16"       # 148.70.x.x
    "152.136.0.0/16"      # 152.136.x.x
    "159.75.0.0/16"       # 159.75.x.x
    "162.14.0.0/16"       # 162.14.x.x
    "162.62.0.0/16"       # 162.62.x.x
    "170.106.0.0/16"      # 170.106.x.x
    "175.24.0.0/14"       # 175.24-175.27
    "175.178.0.0/16"      # 175.178.x.x
    "182.254.0.0/16"      # 182.254.x.x
    "193.112.0.0/16"      # 193.112.x.x
    "203.195.0.0/16"      # 203.195.x.x
    "211.159.0.0/16"      # 211.159.x.x
    "212.64.0.0/16"       # 212.64.x.x
    "212.129.0.0/16"      # 212.129.x.x
    "42.193.0.0/16"       # 42.193.x.x
    "42.194.0.0/16"       # 42.194.x.x
    
    # ========== AWS（全封）==========
    "3.0.0.0/8"           # 整个 3.x.x.x
    "16.0.0.0/8"          # 整个 16.x.x.x
    "18.0.0.0/8"          # 整个 18.x.x.x
    "54.0.0.0/8"          # 整个 54.x.x.x
    
    # ========== 阿里云（全封）==========
    "8.208.0.0/12"        # 8.208-8.223
    "8.219.0.0/16"        # 8.219.x.x
    "47.0.0.0/8"          # 整个 47.x.x.x
    "39.96.0.0/13"        # 39.96-39.103
    "39.100.0.0/16"       # 39.100.x.x
    "39.104.0.0/14"       # 39.104-39.107
    "112.124.0.0/14"      # 112.124-112.127
    "114.55.0.0/16"       # 114.55.x.x
    "115.28.0.0/15"       # 115.28-115.29
    "115.124.0.0/15"      # 115.124-115.125
    "118.31.0.0/16"       # 118.31.x.x
    "118.178.0.0/16"      # 118.178.x.x
    "119.23.0.0/16"       # 119.23.x.x
    "120.24.0.0/14"       # 120.24-120.27
    "120.55.0.0/16"       # 120.55.x.x
    "120.76.0.0/14"       # 120.76-120.79
    "121.40.0.0/14"       # 121.40-121.43
    "121.196.0.0/14"      # 121.196-121.199
    "139.196.0.0/14"      # 139.196-139.199
    "139.224.0.0/14"      # 139.224-139.227
    "182.92.0.0/16"       # 182.92.x.x
    
    # ========== 华为云（全封）==========
    "119.3.0.0/16"        # 119.3.x.x
    "121.36.0.0/14"       # 121.36-121.39
    "122.112.0.0/14"      # 122.112-122.115
    "124.70.0.0/15"       # 124.70-124.71
    "139.9.0.0/16"        # 139.9.x.x
    "139.159.0.0/16"      # 139.159.x.x
    "114.67.0.0/16"       # 114.67.x.x
    
    # ========== UCloud（全封）==========
    "106.75.0.0/16"       # 106.75.x.x
    "117.50.0.0/16"       # 117.50.x.x
    "152.32.0.0/16"       # 152.32.x.x
    
    # ========== DigitalOcean（全封）==========
    "134.122.0.0/16"      # 134.122.x.x
    "138.68.0.0/16"       # 138.68.x.x
    "139.59.0.0/16"       # 139.59.x.x
    "142.93.0.0/16"       # 142.93.x.x
    "157.230.0.0/16"      # 157.230.x.x
    "159.65.0.0/16"       # 159.65.x.x
    "159.89.0.0/16"       # 159.89.x.x
    "161.35.0.0/16"       # 161.35.x.x
    "164.90.0.0/16"       # 164.90.x.x
    "165.22.0.0/16"       # 165.22.x.x
    "165.227.0.0/16"      # 165.227.x.x
    "167.71.0.0/16"       # 167.71.x.x
    "167.172.0.0/16"      # 167.172.x.x
    "174.138.0.0/16"      # 174.138.x.x
    "178.62.0.0/16"       # 178.62.x.x
    "178.128.0.0/16"      # 178.128.x.x
    "188.166.0.0/16"      # 188.166.x.x
    "64.227.0.0/16"       # 64.227.x.x
    "68.183.0.0/16"       # 68.183.x.x
    
    # ========== OVH（全封）==========
    "51.68.0.0/16"        # 51.68.x.x
    "51.75.0.0/16"        # 51.75.x.x
    "51.77.0.0/16"        # 51.77.x.x
    "51.79.0.0/16"        # 51.79.x.x
    "51.81.0.0/16"        # 51.81.x.x
    "51.83.0.0/16"        # 51.83.x.x
    "51.89.0.0/16"        # 51.89.x.x
    "51.91.0.0/16"        # 51.91.x.x
    "51.161.0.0/16"       # 51.161.x.x
    "51.195.0.0/16"       # 51.195.x.x
    "51.210.0.0/16"       # 51.210.x.x
    "51.222.0.0/16"       # 51.222.x.x
    "37.187.0.0/16"       # 37.187.x.x
    "46.105.0.0/16"       # 46.105.x.x
    "91.121.0.0/16"       # 91.121.x.x
    "144.217.0.0/16"      # 144.217.x.x
    "149.56.0.0/16"       # 149.56.x.x
    "158.69.0.0/16"       # 158.69.x.x
    "192.95.0.0/16"       # 192.95.x.x
    "198.27.0.0/16"       # 198.27.x.x
    "217.182.0.0/16"      # 217.182.x.x
    "15.235.0.0/16"       # 15.235.x.x
    
    # ========== Hetzner（全封）==========
    "65.108.0.0/16"       # 65.108.x.x
    "65.109.0.0/16"       # 65.109.x.x
    "78.46.0.0/15"        # 78.46-78.47
    "88.198.0.0/16"       # 88.198.x.x
    "88.99.0.0/16"        # 88.99.x.x
    "95.216.0.0/16"       # 95.216.x.x
    "95.217.0.0/16"       # 95.217.x.x
    "116.202.0.0/16"      # 116.202.x.x
    "116.203.0.0/16"      # 116.203.x.x
    "135.181.0.0/16"      # 135.181.x.x
    "136.243.0.0/16"      # 136.243.x.x
    "138.201.0.0/16"      # 138.201.x.x
    "144.76.0.0/16"       # 144.76.x.x
    "148.251.0.0/16"      # 148.251.x.x
    "159.69.0.0/16"       # 159.69.x.x
    "168.119.0.0/16"      # 168.119.x.x
    "178.63.0.0/16"       # 178.63.x.x
    "195.201.0.0/16"      # 195.201.x.x
    "213.133.0.0/16"      # 213.133.x.x
    "213.239.0.0/16"      # 213.239.x.x
    
    # ========== Vultr（全封）==========
    "45.32.0.0/16"        # 45.32.x.x
    "45.63.0.0/16"        # 45.63.x.x
    "45.76.0.0/16"        # 45.76.x.x
    "45.77.0.0/16"        # 45.77.x.x
    "64.176.0.0/16"       # 64.176.x.x
    "66.42.0.0/16"        # 66.42.x.x
    "78.141.0.0/16"       # 78.141.x.x
    "95.179.0.0/16"       # 95.179.x.x
    "104.156.0.0/16"      # 104.156.x.x
    "104.238.0.0/16"      # 104.238.x.x
    "108.61.0.0/16"       # 108.61.x.x
    "136.244.0.0/16"      # 136.244.x.x
    "137.220.0.0/16"      # 137.220.x.x
    "140.82.0.0/16"       # 140.82.x.x
    "141.164.0.0/16"      # 141.164.x.x
    "144.202.0.0/16"      # 144.202.x.x
    "149.28.0.0/16"       # 149.28.x.x
    "155.138.0.0/16"      # 155.138.x.x
    "199.247.0.0/16"      # 199.247.x.x
    "207.148.0.0/16"      # 207.148.x.x
    "208.167.0.0/16"      # 208.167.x.x
    "217.69.0.0/16"       # 217.69.x.x
    
    # ========== Linode（全封）==========
    "45.33.0.0/16"        # 45.33.x.x
    "45.56.0.0/16"        # 45.56.x.x
    "45.79.0.0/16"        # 45.79.x.x
    "50.116.0.0/16"       # 50.116.x.x
    "66.228.0.0/16"       # 66.228.x.x
    "69.164.0.0/16"       # 69.164.x.x
    "74.207.0.0/16"       # 74.207.x.x
    "96.126.0.0/16"       # 96.126.x.x
    "97.107.0.0/16"       # 97.107.x.x
    "139.162.0.0/16"      # 139.162.x.x
    "172.104.0.0/15"      # 172.104-172.105
    "173.230.0.0/16"      # 173.230.x.x
    "173.255.0.0/16"      # 173.255.x.x
    "178.79.0.0/16"       # 178.79.x.x
    "192.155.0.0/16"      # 192.155.x.x
    "198.58.0.0/16"       # 198.58.x.x
    "198.74.0.0/16"       # 198.74.x.x
    
    # ========== Facebook/Meta（全封）==========
    "31.13.0.0/16"        # 31.13.x.x
    "66.220.0.0/16"       # 66.220.x.x
    "69.63.0.0/16"        # 69.63.x.x
    "69.171.0.0/16"       # 69.171.x.x
    "157.240.0.0/16"      # 157.240.x.x
    "173.252.0.0/16"      # 173.252.x.x
    "179.60.0.0/16"       # 179.60.x.x
    
    # ========== Google（全封）==========
    "35.0.0.0/8"          # 整个 35.x.x.x
    "64.233.0.0/16"       # 64.233.x.x
    "66.102.0.0/16"       # 66.102.x.x
    "66.249.0.0/16"       # 66.249.x.x（Googlebot）
    "72.14.192.0/18"      # 72.14.192-255
    "74.125.0.0/16"       # 74.125.x.x
    "108.177.0.0/17"      # 108.177.0-127
    "142.250.0.0/15"      # 142.250-142.251
    "172.217.0.0/16"      # 172.217.x.x
    "173.194.0.0/16"      # 173.194.x.x
    "192.178.0.0/15"      # 192.178-192.179
    "209.85.128.0/17"     # 209.85.128-255
    "216.58.0.0/16"       # 216.58.x.x
    "216.239.32.0/19"     # 216.239.32-63
    
    # ========== SEO 爬虫/扫描器（全封）==========
    # --- Semrush ---
    "185.191.171.0/24"    # Semrush
    "185.191.0.0/16"      # Semrush 大段
    "45.33.2.0/24"        # Semrush
    "72.14.199.0/24"      # Semrush
    
    # --- Ahrefs ---
    "54.36.148.0/24"      # Ahrefs
    "54.36.149.0/24"      # Ahrefs
    "54.36.150.0/24"      # Ahrefs
    "195.154.122.0/24"    # Ahrefs
    "195.154.123.0/24"    # Ahrefs
    "195.154.126.0/24"    # Ahrefs
    "195.154.127.0/24"    # Ahrefs
    
    # --- Majestic ---
    "46.4.0.0/16"         # Majestic (Hetzner)
    "78.46.0.0/16"        # Majestic (Hetzner)
    
    # --- Moz/DotBot ---
    "216.244.66.0/24"     # DotBot/Moz
    "216.244.0.0/16"      # DotBot 大段
    
    # --- Censys ---
    "162.142.0.0/16"      # Censys
    "167.248.133.0/24"    # Censys
    "167.94.0.0/16"       # Censys
    "71.6.0.0/16"         # Censys/扫描
    
    # --- Shodan ---
    "66.240.192.0/24"     # Shodan
    "66.240.219.0/24"     # Shodan
    "71.6.135.0/24"       # Shodan
    "71.6.165.0/24"       # Shodan
    "71.6.167.0/24"       # Shodan
    "82.221.105.0/24"     # Shodan
    "85.25.43.0/24"       # Shodan
    "85.25.103.0/24"      # Shodan
    "93.120.27.0/24"      # Shodan
    "94.102.49.0/24"      # Shodan
    "188.138.0.0/16"      # Shodan
    "198.20.69.0/24"      # Shodan
    "198.20.70.0/24"      # Shodan
    "198.20.99.0/24"      # Shodan
    
    # --- ZoomInfo ---
    "64.62.252.0/24"      # ZoomInfo
    
    # --- BLEXBot ---
    "176.9.0.0/16"        # BLEXBot (Hetzner)
    
    # --- SerpstatBot ---
    "46.229.168.0/24"     # SerpstatBot
    "46.229.169.0/24"     # SerpstatBot
    
    # --- DataForSEO ---
    "136.243.0.0/16"      # DataForSEO (Hetzner)
    
    # --- MJ12bot ---
    "144.76.0.0/16"       # MJ12bot (Hetzner)
    
    # --- BomboraBot ---
    "52.4.0.0/16"         # BomboraBot
    
    # --- Netcraft ---
    "194.72.238.0/24"     # Netcraft
    "46.51.0.0/16"        # Netcraft
    
    # --- SecurityTrails ---
    "52.8.0.0/16"         # SecurityTrails
    
    # --- 其他扫描器 ---
    "80.82.77.0/24"       # 扫描器
    "89.248.167.0/24"     # 扫描器
    "93.174.95.0/24"      # 扫描器
    "141.98.0.0/16"       # 扫描器
    "198.235.24.0/24"     # 扫描器
    "207.46.0.0/16"       # Bing Bot
    "157.55.0.0/16"       # Bing Bot
    "40.77.0.0/16"        # Bing Bot
    "199.30.0.0/16"       # Bing Bot
    
    # --- Screaming Frog ---
    "91.206.110.0/24"     # Screaming Frog
    
    # --- CCBot (Common Crawl) ---
    "35.196.0.0/16"       # CCBot
    "35.192.0.0/16"       # CCBot
    
    # --- Yandex ---
    "77.88.0.0/16"        # Yandex
    "87.250.224.0/20"     # Yandex
    "93.158.128.0/18"     # Yandex
    "95.108.128.0/17"     # Yandex
    "100.43.64.0/19"      # Yandex
    "130.193.0.0/16"      # Yandex
    "141.8.128.0/18"      # Yandex
    "178.154.128.0/17"    # Yandex
    "199.21.96.0/22"      # Yandex
    "213.180.192.0/19"    # Yandex
    
    # --- PetalBot (华为搜索) ---
    "114.119.0.0/16"    # PetalBot
    
    # --- AppleBot ---
    "17.0.0.0/8"          # AppleBot
    
    # --- Seznam ---
    "77.75.72.0/21"       # SeznamBot
    
    # --- Mail.ru ---
    "217.69.128.0/20"     # Mail.ru Bot
    "94.100.176.0/20"     # Mail.ru Bot
    "185.30.176.0/22"     # Mail.ru Bot
    
    # --- Exabot ---
    "178.255.215.0/24"    # Exabot
    
    # --- Megaindex ---
    "91.242.162.0/24"     # MegaIndex
    
    # --- Proximic ---
    "64.124.8.0/24"       # Proximic
    
    # --- Turnitin ---
    "38.100.41.0/24"      # Turnitin
    
    # --- Grapeshot ---
    "52.86.0.0/16"        # Grapeshot
    
    # --- NerdyBot ---
    "52.0.0.0/8"          # 已全封
    
    # --- ClaudeBot/Anthropic ---
    "160.79.104.0/24"     # ClaudeBot
    
    # --- ChatGPT/OpenAI ---
    "23.98.0.0/16"        # OpenAI
    "20.0.0.0/8"          # 已全封
    
    # --- Other Bots ---
    "5.9.0.0/16"          # Various bots (Hetzner)
    "88.198.0.0/16"       # Various bots (Hetzner)
    "148.251.0.0/16"      # Various bots (Hetzner)
    "78.47.0.0/16"        # Various bots (Hetzner)
    
    # ========== 香港/亚太 IDC ==========
    "118.193.0.0/16"      # 118.193.x.x
    "103.0.0.0/8"         # 整个 103.x.x.x（亚太 IDC）
    
    # ========== 俄罗斯/东欧 IDC ==========
    "77.90.0.0/16"        # 77.90.x.x
    "78.153.0.0/16"       # 78.153.x.x
    "85.208.0.0/16"       # 85.208.x.x
    "91.232.0.0/16"       # 91.232.x.x
    "91.224.0.0/16"       # 91.224.x.x
    "92.53.0.0/16"        # 92.53.x.x
    "185.0.0.0/8"         # 整个 185.x.x.x（欧洲 IDC）
    "193.142.0.0/16"      # 193.142.x.x
    "194.180.0.0/16"      # 194.180.x.x
    "195.178.0.0/16"      # 195.178.x.x
    "188.143.0.0/16"      # 188.143.x.x
    "62.84.0.0/16"        # 62.84.x.x
    "62.60.0.0/16"        # 62.60.x.x
    "87.120.0.0/16"       # 87.120.x.x
    "94.177.0.0/16"       # 94.177.x.x
    "46.138.0.0/16"       # 46.138.x.x
    "81.167.0.0/16"       # 81.167.x.x（挪威）
    "217.76.0.0/16"       # 217.76.x.x（德国）
    
    # ========== 非洲/高风险地区 ==========
    "156.0.0.0/8"         # 156.x.x.x
    "154.0.0.0/8"         # 154.x.x.x
    "196.0.0.0/8"         # 196.x.x.x
    "197.0.0.0/8"         # 197.x.x.x
    "41.0.0.0/8"          # 41.x.x.x
    "102.0.0.0/8"         # 102.x.x.x
    
    # ========== 台湾地区 ISP/IDC ==========
    "1.160.0.0/12"        # 台湾中华电信 1.160-1.175
    "1.200.0.0/14"        # 台湾中华电信 1.200-1.203
    "27.52.0.0/14"        # 台湾中华电信 27.52-27.55
    "36.224.0.0/12"       # 台湾中华电信 36.224-36.239
    "36.224.0.0/14"       # 台湾中华电信
    "49.158.0.0/15"       # 台湾中华电信
    "49.216.0.0/14"       # 台湾中华电信
    "60.248.0.0/14"       # 台湾中华电信 60.248-60.251
    "60.244.0.0/14"       # 台湾中华电信
    "61.216.0.0/14"       # 台湾中华电信 61.216-61.219
    "61.220.0.0/14"       # 台湾中华电信 61.220-61.223
    "61.224.0.0/12"       # 台湾中华电信 61.224-61.239
    "101.8.0.0/14"        # 台湾中华电信
    "101.136.0.0/14"      # 台湾中华电信
    "106.104.0.0/14"      # 台湾中华电信
    "111.240.0.0/12"      # 台湾中华电信 111.240-111.255
    "111.248.0.0/13"      # 台湾中华电信
    "114.24.0.0/14"       # 台湾中华电信
    "114.32.0.0/12"       # 台湾中华电信 114.32-114.47
    "114.136.0.0/13"      # 台湾中华电信
    "118.160.0.0/12"      # 台湾中华电信 118.160-118.175
    "118.168.0.0/14"      # 台湾中华电信
    "122.116.0.0/14"      # 台湾中华电信
    "122.120.0.0/13"      # 台湾中华电信
    "123.192.0.0/13"      # 台湾中华电信
    "123.240.0.0/13"      # 台湾中华电信
    "124.8.0.0/14"        # 台湾中华电信
    "124.12.0.0/14"       # 台湾中华电信
    "125.224.0.0/12"      # 台湾中华电信 125.224-125.239
    "140.112.0.0/12"      # 台湾学术网络
    "163.13.0.0/16"       # 台湾学术网络
    "163.14.0.0/16"       # 台湾学术网络
    "163.15.0.0/16"       # 台湾学术网络
    "163.16.0.0/12"       # 台湾学术网络
    "163.32.0.0/12"       # 台湾学术网络
    "168.95.0.0/16"       # 台湾中华电信
    "175.96.0.0/12"       # 台湾中华电信 175.96-175.111
    "175.180.0.0/14"      # 台湾中华电信
    "175.98.0.0/15"       # 台湾中华电信
    "180.176.0.0/12"      # 台湾中华电信 180.176-180.191
    "180.204.0.0/14"      # 台湾中华电信
    "182.234.0.0/15"      # 台湾中华电信
    "182.233.0.0/16"      # 台湾中华电信
    "203.66.0.0/16"       # 台湾中华电信
    "203.67.0.0/16"       # 台湾中华电信
    "203.68.0.0/14"       # 台湾中华电信
    "203.72.0.0/14"       # 台湾中华电信
    "210.17.0.0/16"       # 台湾中华电信
    "210.59.0.0/16"       # 台湾中华电信
    "210.60.0.0/14"       # 台湾中华电信
    "210.64.0.0/12"       # 台湾中华电信 210.64-210.79
    "211.20.0.0/14"       # 台湾中华电信
    "211.72.0.0/14"       # 台湾中华电信
    "211.76.0.0/14"       # 台湾中华电信
    "218.160.0.0/12"      # 台湾中华电信 218.160-218.175
    "219.68.0.0/14"       # 台湾中华电信
    "219.80.0.0/14"       # 台湾中华电信
    "219.84.0.0/14"       # 台湾中华电信
    "220.128.0.0/12"      # 台湾中华电信 220.128-220.143
    "220.132.0.0/14"      # 台湾中华电信
    "220.136.0.0/13"      # 台湾中华电信
    # 台湾其他 ISP
    "59.112.0.0/13"       # 台湾远传电信
    "59.120.0.0/13"       # 台湾远传电信
    "59.124.0.0/14"       # 台湾远传电信
    "111.82.0.0/15"       # 台湾远传电信
    "111.80.0.0/14"       # 台湾远传电信
    "175.181.0.0/16"      # 台湾远传电信
    "175.182.0.0/15"      # 台湾远传电信
    "42.72.0.0/14"        # 台湾亚太电信
    "42.76.0.0/14"        # 台湾亚太电信
    "106.1.0.0/16"        # 台湾亚太电信
    "110.26.0.0/15"       # 台湾亚太电信
    "110.28.0.0/14"       # 台湾亚太电信
    "117.56.0.0/14"       # 台湾政府网络
    "150.116.0.0/14"      # 台湾
    "150.117.0.0/16"      # 台湾
    "203.204.0.0/14"      # 台湾
    # 台湾 IDC/云服务
    "103.31.196.0/22"     # 台湾 IDC
    "103.246.0.0/16"      # 台湾 IDC
    "45.64.0.0/16"        # 台湾 IDC
    "45.113.0.0/16"       # 台湾 IDC
    "103.18.0.0/16"       # 台湾 IDC
    
    # ========== 其他国外 IDC/VPS ==========
    "204.101.0.0/16"      # 204.101.x.x
    "151.240.0.0/16"      # 151.240.x.x
    "161.178.0.0/16"      # 161.178.x.x
    "84.253.0.0/16"       # 84.253.x.x
    "84.247.0.0/16"       # 84.247.x.x
    "172.190.0.0/16"      # 172.190.x.x
    "172.161.0.0/16"      # 172.161.x.x
    "100.42.0.0/16"       # 100.42.x.x
    "45.249.0.0/16"       # 45.249.x.x
    "45.82.0.0/16"        # 45.82.x.x
    "45.148.0.0/16"       # 45.148.x.x
    "45.141.0.0/16"       # 45.141.x.x
    "45.58.0.0/16"        # 45.58.x.x
    "45.89.0.0/16"        # 45.89.x.x
    "45.135.0.0/16"       # 45.135.x.x
    "45.132.0.0/16"       # 45.132.x.x
    "45.156.0.0/16"       # 45.156.x.x
    "45.187.0.0/16"       # 45.187.x.x
    "192.144.0.0/16"      # 192.144.x.x
    "199.45.0.0/16"       # 199.45.x.x
    "107.150.0.0/16"      # 107.150.x.x
    "130.33.0.0/16"       # 130.33.x.x
    "140.179.0.0/16"      # 140.179.x.x
    "138.99.0.0/16"       # 138.99.x.x
    "144.31.0.0/16"       # 144.31.x.x
    "149.88.0.0/16"       # 149.88.x.x
    "181.177.0.0/16"      # 181.177.x.x
    "198.44.0.0/16"       # 198.44.x.x
    "202.140.0.0/16"      # 202.140.x.x
    "202.163.0.0/16"      # 202.163.x.x
    "202.181.0.0/16"      # 202.181.x.x
    "203.168.0.0/16"      # 203.168.x.x
    "204.76.0.0/16"       # 204.76.x.x
    "205.210.0.0/16"      # 205.210.x.x
    "208.98.0.0/16"       # 208.98.x.x
    "216.118.0.0/16"      # 216.118.x.x
    "216.180.0.0/16"      # 216.180.x.x
    "217.114.0.0/16"      # 217.114.x.x
    "37.114.0.0/16"       # 37.114.x.x
    "38.22.0.0/16"        # 38.22.x.x
    "38.148.0.0/16"       # 38.148.x.x
    "38.240.0.0/16"       # 38.240.x.x
    "57.128.0.0/16"       # 57.128.x.x
    "57.141.0.0/16"       # 57.141.x.x
    "83.99.0.0/16"        # 83.99.x.x
    "84.246.0.0/16"       # 84.246.x.x
    "104.143.0.0/16"      # 104.143.x.x
    "195.24.0.0/16"       # 195.24.x.x
    "195.86.0.0/16"       # 195.86.x.x
    "221.7.0.0/16"        # 221.7.x.x
    "59.55.0.0/16"        # 59.55.x.x
    "223.244.0.0/16"      # 223.244.x.x
    
    # ========== 更多全球 IDC 机房 ==========
    # --- Scaleway ---
    "51.15.0.0/16"        # Scaleway
    "62.210.0.0/16"       # Scaleway
    "163.172.0.0/16"      # Scaleway
    "212.47.224.0/19"     # Scaleway
    
    # --- Contabo ---
    "62.171.0.0/16"       # Contabo
    "173.212.0.0/16"      # Contabo
    "167.86.0.0/16"       # Contabo
    "207.180.0.0/16"      # Contabo
    "144.91.0.0/16"       # Contabo
    "161.97.0.0/16"       # Contabo
    "5.189.0.0/16"        # Contabo
    
    # --- HostGator/EIG ---
    "192.185.0.0/16"      # HostGator
    "50.87.0.0/16"        # HostGator
    "108.167.0.0/16"      # HostGator
    "192.254.0.0/16"      # HostGator
    
    # --- GoDaddy ---
    "184.168.0.0/16"      # GoDaddy
    "50.62.0.0/16"        # GoDaddy
    "50.63.0.0/16"        # GoDaddy
    "68.178.0.0/16"       # GoDaddy
    "97.74.0.0/16"        # GoDaddy
    "173.201.0.0/16"      # GoDaddy
    "198.71.0.0/16"       # GoDaddy
    
    # --- Namecheap/HostWinds ---
    "198.54.0.0/16"       # Namecheap
    "162.0.0.0/16"        # Namecheap
    "104.168.0.0/16"      # HostWinds
    "104.200.0.0/16"      # HostWinds
    
    # --- QuadraNet ---
    "198.55.0.0/16"       # QuadraNet
    "67.213.0.0/16"       # QuadraNet
    "96.44.0.0/16"        # QuadraNet
    
    # --- ColoCrossing ---
    "192.3.0.0/16"        # ColoCrossing
    "107.175.0.0/16"      # ColoCrossing
    "107.172.0.0/16"      # ColoCrossing
    "198.23.0.0/16"       # ColoCrossing
    "23.94.0.0/16"        # ColoCrossing
    "23.95.0.0/16"        # ColoCrossing
    "192.210.0.0/16"      # ColoCrossing
    
    # --- Psychz Networks ---
    "23.227.0.0/16"       # Psychz
    "23.225.0.0/16"       # Psychz
    "104.37.0.0/16"       # Psychz
    "172.245.0.0/16"      # Psychz
    
    # --- Choopa/GameServers ---
    "104.207.0.0/16"      # Choopa
    "209.250.0.0/16"      # Choopa
    "66.55.0.0/16"        # GameServers
    
    # --- Leaseweb ---
    "5.79.0.0/16"         # Leaseweb
    "37.48.0.0/16"        # Leaseweb
    "46.165.0.0/16"       # Leaseweb
    "85.17.0.0/16"        # Leaseweb
    "94.75.0.0/16"        # Leaseweb
    "95.211.0.0/16"       # Leaseweb
    "178.162.0.0/16"      # Leaseweb
    "209.58.0.0/16"       # Leaseweb
    
    # --- ServerHub ---
    "63.141.0.0/16"       # ServerHub
    "108.171.0.0/16"      # ServerHub
    
    # --- RamNode ---
    "107.189.0.0/16"      # RamNode
    "23.129.0.0/16"       # RamNode
    
    # --- BuyVM/FranTech ---
    "198.251.0.0/16"      # BuyVM
    "199.195.0.0/16"      # BuyVM
    "205.185.0.0/16"      # BuyVM
    
    # --- Datacamp/M247 ---
    "37.120.0.0/16"       # M247
    "86.105.0.0/16"       # M247
    "89.35.0.0/16"        # M247
    "193.138.0.0/16"      # M247
    "185.242.0.0/16"      # M247
    
    # --- Hostinger ---
    "31.220.0.0/16"       # Hostinger
    "193.122.0.0/16"      # Hostinger
    "141.136.0.0/16"      # Hostinger
    "145.14.0.0/16"       # Hostinger
    "91.193.0.0/16"       # Hostinger
    
    # --- SiteGround ---
    "198.57.0.0/16"       # SiteGround
    "35.214.0.0/16"       # SiteGround (Google Cloud)
    
    # --- Cloudflare (部分，通常不封) ---
    # "104.16.0.0/12"     # Cloudflare - 可能影响正常网站
    # "172.64.0.0/13"     # Cloudflare
    # "173.245.48.0/20"   # Cloudflare
    
    # --- Oracle Cloud ---
    "129.146.0.0/16"      # Oracle Cloud
    "129.150.0.0/16"      # Oracle Cloud
    "129.151.0.0/16"      # Oracle Cloud
    "129.152.0.0/16"      # Oracle Cloud
    "129.153.0.0/16"      # Oracle Cloud
    "129.154.0.0/16"      # Oracle Cloud
    "129.155.0.0/16"      # Oracle Cloud
    "129.156.0.0/16"      # Oracle Cloud
    "129.157.0.0/16"      # Oracle Cloud
    "129.158.0.0/16"      # Oracle Cloud
    "129.159.0.0/16"      # Oracle Cloud
    "132.145.0.0/16"      # Oracle Cloud
    "132.226.0.0/16"      # Oracle Cloud
    "138.1.0.0/16"        # Oracle Cloud
    "140.238.0.0/16"      # Oracle Cloud
    "144.24.0.0/16"       # Oracle Cloud
    "150.136.0.0/16"      # Oracle Cloud
    "152.67.0.0/16"       # Oracle Cloud
    "152.70.0.0/16"       # Oracle Cloud
    "158.101.0.0/16"      # Oracle Cloud
    "168.138.0.0/16"      # Oracle Cloud
    "192.29.0.0/16"       # Oracle Cloud
    "193.122.0.0/16"      # Oracle Cloud
    "193.123.0.0/16"      # Oracle Cloud
    
    # --- IBM Cloud/SoftLayer ---
    "158.175.0.0/16"      # IBM Cloud
    "159.8.0.0/16"        # IBM Cloud
    "159.122.0.0/16"      # IBM Cloud
    "161.202.0.0/16"      # IBM Cloud
    "169.38.0.0/16"       # IBM Cloud
    "169.44.0.0/16"       # IBM Cloud
    "169.45.0.0/16"       # IBM Cloud
    "169.46.0.0/16"       # IBM Cloud
    "169.47.0.0/16"       # IBM Cloud
    "169.48.0.0/16"       # IBM Cloud
    "169.53.0.0/16"       # IBM Cloud
    "169.54.0.0/16"       # IBM Cloud
    "169.55.0.0/16"       # IBM Cloud
    "169.56.0.0/16"       # IBM Cloud
    "169.57.0.0/16"       # IBM Cloud
    "169.60.0.0/16"       # IBM Cloud
    "169.61.0.0/16"       # IBM Cloud
    "169.62.0.0/16"       # IBM Cloud
    "169.63.0.0/16"       # IBM Cloud
    "174.36.0.0/16"       # IBM Cloud
    "174.37.0.0/16"       # IBM Cloud
    "184.172.0.0/16"      # IBM Cloud
    "184.173.0.0/16"      # IBM Cloud
    "208.43.0.0/16"       # IBM Cloud
    
    # --- Rackspace ---
    "64.39.0.0/16"        # Rackspace
    "64.49.0.0/16"        # Rackspace
    "67.192.0.0/16"       # Rackspace
    "69.20.0.0/16"        # Rackspace
    "72.3.0.0/16"         # Rackspace
    "72.4.0.0/16"         # Rackspace
    "74.205.0.0/16"       # Rackspace
    "98.129.0.0/16"       # Rackspace
    "120.136.0.0/16"      # Rackspace
    "162.209.0.0/16"      # Rackspace
    "166.78.0.0/16"       # Rackspace
    "173.203.0.0/16"      # Rackspace
    "184.106.0.0/16"      # Rackspace
    "198.61.0.0/16"       # Rackspace
    "198.101.0.0/16"      # Rackspace
    
    # --- LeaseWeb Asia ---
    "103.254.0.0/16"      # LeaseWeb Asia
    "43.245.0.0/16"       # LeaseWeb Asia
    
    # --- Zenlayer ---
    "43.241.0.0/16"       # Zenlayer
    "43.242.0.0/16"       # Zenlayer
    "103.192.0.0/16"      # Zenlayer
    
    # --- DMIT ---
    "154.17.0.0/16"       # DMIT
    "154.31.0.0/16"       # DMIT
    
    # --- Bandwagonhost/搬瓦工 ---
    "65.49.0.0/16"        # Bandwagonhost
    "104.194.0.0/16"      # Bandwagonhost
    "104.225.0.0/16"      # Bandwagonhost
    "173.82.0.0/16"       # Bandwagonhost
    "184.170.0.0/16"      # Bandwagonhost
    "198.35.0.0/16"       # Bandwagonhost
    "45.43.0.0/16"        # Bandwagonhost
    
    # --- GigsGigsCloud ---
    "23.106.0.0/16"       # GigsGigsCloud
    "107.148.0.0/16"      # GigsGigsCloud
    
    # --- CloudIPLC/IPLC ---
    "154.12.0.0/16"       # CloudIPLC
    "154.21.0.0/16"       # CloudIPLC
    
    # --- 其他常见攻击源 IDC ---
    "5.188.0.0/16"        # IDC
    "5.255.0.0/16"        # Yandex IDC
    "31.184.0.0/16"       # IDC
    "37.9.0.0/16"         # IDC
    "45.9.0.0/16"         # IDC
    "45.11.0.0/16"        # IDC
    "45.12.0.0/16"        # IDC
    "45.14.0.0/16"        # IDC
    "45.15.0.0/16"        # IDC
    "45.67.0.0/16"        # IDC
    "45.80.0.0/16"        # IDC
    "45.81.0.0/16"        # IDC
    "45.83.0.0/16"        # IDC
    "45.84.0.0/16"        # IDC
    "45.86.0.0/16"        # IDC
    "45.87.0.0/16"        # IDC
    "45.88.0.0/16"        # IDC
    "45.90.0.0/16"        # IDC
    "45.91.0.0/16"        # IDC
    "45.92.0.0/16"        # IDC
    "45.93.0.0/16"        # IDC
    "45.95.0.0/16"        # IDC
    "45.128.0.0/16"       # IDC
    "45.129.0.0/16"       # IDC
    "45.130.0.0/16"       # IDC
    "45.131.0.0/16"       # IDC
    "45.133.0.0/16"       # IDC
    "45.134.0.0/16"       # IDC
    "45.136.0.0/16"       # IDC
    "45.137.0.0/16"       # IDC
    "45.138.0.0/16"       # IDC
    "45.139.0.0/16"       # IDC
    "45.140.0.0/16"       # IDC
    "45.142.0.0/16"       # IDC
    "45.143.0.0/16"       # IDC
    "45.144.0.0/16"       # IDC
    "45.145.0.0/16"       # IDC
    "45.146.0.0/16"       # IDC
    "45.147.0.0/16"       # IDC
    "45.149.0.0/16"       # IDC
    "45.150.0.0/16"       # IDC
    "45.151.0.0/16"       # IDC
    "45.152.0.0/16"       # IDC
    "45.153.0.0/16"       # IDC
    "45.154.0.0/16"       # IDC
    "45.155.0.0/16"       # IDC
    "45.157.0.0/16"       # IDC
    "45.158.0.0/16"       # IDC
    "45.159.0.0/16"       # IDC
    "89.187.0.0/16"       # IDC
    "91.189.0.0/16"       # IDC
    "91.190.0.0/16"       # IDC
    "91.191.0.0/16"       # IDC
    "91.192.0.0/16"       # IDC
    "91.193.0.0/16"       # IDC
    "91.194.0.0/16"       # IDC
    "91.195.0.0/16"       # IDC
    "91.196.0.0/16"       # IDC
    "91.197.0.0/16"       # IDC
    "91.198.0.0/16"       # IDC
    "91.199.0.0/16"       # IDC
    "91.200.0.0/16"       # IDC
    "91.201.0.0/16"       # IDC
    "91.202.0.0/16"       # IDC
    "91.203.0.0/16"       # IDC
    "91.204.0.0/16"       # IDC
    "91.205.0.0/16"       # IDC
    "91.206.0.0/16"       # IDC
    "91.207.0.0/16"       # IDC
    "91.208.0.0/16"       # IDC
    "91.209.0.0/16"       # IDC
    "91.210.0.0/16"       # IDC
    "91.211.0.0/16"       # IDC
    "91.212.0.0/16"       # IDC
    "91.213.0.0/16"       # IDC
    "91.214.0.0/16"       # IDC
    "91.215.0.0/16"       # IDC
    "91.216.0.0/16"       # IDC
    "91.217.0.0/16"       # IDC
    "91.218.0.0/16"       # IDC
    "91.219.0.0/16"       # IDC
    "91.220.0.0/16"       # IDC
    "91.221.0.0/16"       # IDC
    "91.222.0.0/16"       # IDC
    "91.223.0.0/16"       # IDC
    "91.225.0.0/16"       # IDC
    "91.226.0.0/16"       # IDC
    "91.227.0.0/16"       # IDC
    "91.228.0.0/16"       # IDC
    "91.229.0.0/16"       # IDC
    "91.230.0.0/16"       # IDC
    "91.231.0.0/16"       # IDC
    "91.233.0.0/16"       # IDC
    "91.234.0.0/16"       # IDC
    "91.235.0.0/16"       # IDC
    "91.236.0.0/16"       # IDC
    "91.237.0.0/16"       # IDC
    "91.238.0.0/16"       # IDC
    "91.239.0.0/16"       # IDC
    "91.240.0.0/16"       # IDC
    "91.241.0.0/16"       # IDC
    "91.242.0.0/16"       # IDC
    "91.243.0.0/16"       # IDC
    "91.244.0.0/16"       # IDC
    "91.245.0.0/16"       # IDC
    "91.246.0.0/16"       # IDC
    "91.247.0.0/16"       # IDC
    
    # ========== 特定攻击源（非家庭宽带）==========
    "111.29.85.0/24"      # 特定攻击IP
    "118.107.0.0/16"      # IDC
    "123.151.0.0/16"      # IDC
    "113.111.0.0/16"      # IDC
    "114.139.0.0/16"      # IDC
    "123.187.0.0/16"      # IDC
    "61.155.0.0/16"       # 江苏IDC机房
    "61.186.0.0/16"       # IDC
    
    # ========== 漏网之鱼补充 ==========
    "68.218.0.0/16"       # 美国 ISP/IDC
    "27.124.0.0/16"       # 韩国 IDC
    "14.103.0.0/16"       # 中国 IDC
    "159.203.0.0/16"      # DigitalOcean
    "147.182.0.0/16"      # DigitalOcean
    "137.184.0.0/16"      # DigitalOcean
    "209.38.0.0/16"       # DigitalOcean
    "167.99.0.0/16"       # DigitalOcean
    "34.0.0.0/8"          # Google Cloud 整段
    "146.190.0.0/16"      # DigitalOcean
    "206.189.0.0/16"      # DigitalOcean
    "143.198.0.0/16"      # DigitalOcean
    "143.110.0.0/16"      # DigitalOcean
    "104.131.0.0/16"      # DigitalOcean
    "104.236.0.0/16"      # DigitalOcean
    "107.170.0.0/16"      # DigitalOcean
    "162.243.0.0/16"      # DigitalOcean
    "192.241.0.0/16"      # DigitalOcean
    "198.199.0.0/16"      # DigitalOcean
    "45.55.0.0/16"        # DigitalOcean
    "67.205.0.0/16"       # DigitalOcean
    "69.55.0.0/16"        # Linode/IDC
    "173.199.0.0/16"      # Linode/IDC
    "96.30.0.0/16"        # IDC
    
    # ========== 最新漏网补充 ==========
    "100.31.0.0/16"       # AWS
    "100.30.0.0/16"       # AWS
    "138.197.0.0/16"      # DigitalOcean
    "104.248.0.0/16"      # DigitalOcean
    "46.101.0.0/16"       # DigitalOcean
    "44.0.0.0/8"          # AWS 整段
    "98.82.0.0/16"        # AWS
    "98.83.0.0/16"        # AWS
    "98.91.0.0/16"        # AWS
    "161.156.0.0/16"      # IBM Cloud
    "144.126.0.0/16"      # DigitalOcean
    "45.204.0.0/16"       # 非洲 IDC
    "157.245.0.0/16"      # DigitalOcean
    "165.232.0.0/16"      # DigitalOcean
    "159.223.0.0/16"      # DigitalOcean
    "134.209.0.0/16"      # DigitalOcean
    "134.199.0.0/16"      # DigitalOcean
    "5.101.0.0/16"        # IDC
    "117.144.0.0/16"      # 上海移动（可能是IDC）
    "44.202.0.0/16"       # AWS
    
    # ========== 国内高频攻击源（精确C段，避免误封家庭宽带）==========
    # 以下是从实际攻击日志中提取的精确IP段
    
    # --- 上海电信 IDC ---
    "101.89.87.0/24"      # 高频攻击源
    "101.89.45.0/24"      # 高频攻击源
    
    # --- 广东电信 IDC ---
    "113.95.140.0/24"     # 高频攻击源
    "113.95.132.0/24"     # 高频攻击源
    "183.7.86.0/24"       # 高频攻击源
    "183.10.231.0/24"     # 高频攻击源
    "125.94.76.0/24"      # 高频攻击源
    "27.46.46.0/24"       # 高频攻击源
    
    # --- 江苏电信 IDC ---
    "61.155.157.0/24"     # 高频攻击源（持续出现）
    "61.155.158.0/24"     # 高频攻击源
    "61.155.159.0/24"     # 高频攻击源
    "49.65.18.0/24"       # 高频攻击源
    "117.62.235.0/24"     # 高频攻击源
    
    # --- 浙江电信 IDC ---
    "115.231.78.0/24"     # 高频攻击源
    "115.231.79.0/24"     # 高频攻击源
    "125.114.151.0/24"    # 高频攻击源
    
    # --- 河北电信/移动 IDC ---
    "110.252.45.0/24"     # 高频攻击源
    "111.29.85.0/24"      # 高频攻击源
    
    # --- 山东联通 IDC ---
    "27.124.12.0/24"      # 高频攻击源
    
    # --- 湖北电信 IDC ---
    "111.172.35.0/24"     # 高频攻击源
    
    # --- 安徽电信 IDC ---
    "223.244.35.0/24"     # 高频攻击源
    "36.56.208.0/24"      # 高频攻击源
    
    # --- 河南电信 IDC ---
    "42.243.152.0/24"     # 高频攻击源
    
    # --- 湖南电信 IDC ---
    "59.55.229.0/24"      # 高频攻击源
    
    # --- 江西联通 IDC ---
    "221.7.192.0/24"      # 高频攻击源
    
    # --- 广州移动 IDC ---
    "112.96.110.0/24"     # 高频攻击源
    "119.125.127.0/24"    # 高频攻击源
    
    # --- 南京电信 IDC ---
    "180.110.203.0/24"    # 高频攻击源
    
    # --- 伊朗/中东高风险 ---
    "151.240.205.0/24"    # 伊朗攻击源
    
    # ========== 国内知名 IDC 机房（精确C段）==========
    
    # --- 北京 IDC ---
    "59.151.0.0/24"       # 北京世纪互联
    "59.151.1.0/24"       # 北京世纪互联
    "59.151.2.0/24"       # 北京世纪互联
    "59.151.3.0/24"       # 北京世纪互联
    "59.151.4.0/24"       # 北京世纪互联
    "59.151.5.0/24"       # 北京世纪互联
    "202.108.22.0/24"     # 北京联通 IDC
    "202.108.23.0/24"     # 北京联通 IDC
    "202.106.0.0/24"      # 北京联通 IDC
    "123.58.180.0/24"     # 北京电信通
    "123.58.181.0/24"     # 北京电信通
    "123.58.182.0/24"     # 北京电信通
    "114.255.71.0/24"     # 北京联通 IDC
    "114.255.72.0/24"     # 北京联通 IDC
    "111.206.36.0/24"     # 北京移动 IDC
    "111.206.37.0/24"     # 北京移动 IDC
    "223.72.89.0/24"      # 北京移动 IDC
    "223.72.90.0/24"      # 北京移动 IDC
    "223.72.91.0/24"      # 北京移动 IDC
    "106.75.0.0/24"       # UCloud 北京
    "106.75.1.0/24"       # UCloud 北京
    "106.75.2.0/24"       # UCloud 北京
    "106.75.3.0/24"       # UCloud 北京
    "106.75.4.0/24"       # UCloud 北京
    "117.50.0.0/24"       # 金山云 北京
    "117.50.1.0/24"       # 金山云 北京
    "117.50.2.0/24"       # 金山云 北京
    
    # --- 上海 IDC ---
    "58.247.0.0/24"       # 上海电信 IDC
    "58.247.1.0/24"       # 上海电信 IDC
    "58.247.200.0/24"     # 上海电信 IDC
    "58.247.201.0/24"     # 上海电信 IDC
    "58.247.202.0/24"     # 上海电信 IDC
    "116.236.0.0/24"      # 上海电信 IDC
    "116.236.1.0/24"      # 上海电信 IDC
    "180.153.0.0/24"      # 上海电信 IDC
    "180.153.1.0/24"      # 上海电信 IDC
    "180.153.2.0/24"      # 上海电信 IDC
    "180.153.10.0/24"     # 360 上海 IDC
    "180.153.11.0/24"     # 360 上海 IDC
    "222.73.0.0/24"       # 上海电信 IDC
    "222.73.1.0/24"       # 上海电信 IDC
    "222.73.60.0/24"      # 上海电信 IDC
    "114.80.0.0/24"       # 上海电信 IDC
    "114.80.1.0/24"       # 上海电信 IDC
    "114.80.200.0/24"     # 上海电信 IDC
    "101.227.0.0/24"      # 上海移动 IDC
    "101.227.1.0/24"      # 上海移动 IDC
    "101.226.0.0/24"      # 上海移动 IDC
    "101.226.1.0/24"      # 上海移动 IDC
    "101.89.0.0/24"       # 上海电信 IDC
    "101.89.1.0/24"       # 上海电信 IDC
    "101.89.2.0/24"       # 上海电信 IDC
    "112.65.0.0/24"       # 上海移动 IDC
    "112.65.1.0/24"       # 上海移动 IDC
    "139.196.0.0/24"      # 阿里云上海
    "139.196.1.0/24"      # 阿里云上海
    "47.100.0.0/24"       # 阿里云上海
    "47.100.1.0/24"       # 阿里云上海
    "47.101.0.0/24"       # 阿里云上海
    "47.101.1.0/24"       # 阿里云上海
    
    # --- 广州/深圳 IDC ---
    "14.17.0.0/24"        # 广州电信 IDC
    "14.17.1.0/24"        # 广州电信 IDC
    "14.17.2.0/24"        # 广州电信 IDC
    "14.215.0.0/24"       # 广州电信 IDC（百度除外的段）
    "14.215.1.0/24"       # 广州电信 IDC
    "113.105.0.0/24"      # 广州电信 IDC
    "113.105.1.0/24"      # 广州电信 IDC
    "119.147.0.0/24"      # 深圳电信 IDC
    "119.147.1.0/24"      # 深圳电信 IDC
    "183.60.0.0/24"       # 广州移动 IDC
    "183.60.1.0/24"       # 广州移动 IDC
    "183.3.0.0/24"        # 深圳电信 IDC
    "183.3.1.0/24"        # 深圳电信 IDC
    "183.3.200.0/24"      # 腾讯深圳
    "183.3.201.0/24"      # 腾讯深圳
    "113.96.0.0/24"       # 广州移动 IDC
    "113.96.1.0/24"       # 广州移动 IDC
    "120.24.0.0/24"       # 阿里云深圳
    "120.24.1.0/24"       # 阿里云深圳
    "120.25.0.0/24"       # 阿里云深圳
    "120.25.1.0/24"       # 阿里云深圳
    "120.76.0.0/24"       # 阿里云深圳
    "120.76.1.0/24"       # 阿里云深圳
    "120.77.0.0/24"       # 阿里云深圳
    "120.77.1.0/24"       # 阿里云深圳
    "120.78.0.0/24"       # 阿里云深圳
    "120.78.1.0/24"       # 阿里云深圳
    "120.79.0.0/24"       # 阿里云深圳
    "120.79.1.0/24"       # 阿里云深圳
    
    # --- 杭州 IDC ---
    "115.236.0.0/24"      # 杭州电信 IDC
    "115.236.1.0/24"      # 杭州电信 IDC
    "115.238.0.0/24"      # 杭州电信 IDC
    "115.238.1.0/24"      # 杭州电信 IDC
    "122.224.0.0/24"      # 杭州电信 IDC
    "122.224.1.0/24"      # 杭州电信 IDC
    "122.225.0.0/24"      # 杭州电信 IDC
    "122.225.1.0/24"      # 杭州电信 IDC
    "115.29.0.0/24"       # 阿里云杭州
    "115.29.1.0/24"       # 阿里云杭州
    "121.40.0.0/24"       # 阿里云杭州
    "121.40.1.0/24"       # 阿里云杭州
    "121.41.0.0/24"       # 阿里云杭州
    "121.41.1.0/24"       # 阿里云杭州
    "121.42.0.0/24"       # 阿里云杭州
    "121.42.1.0/24"       # 阿里云杭州
    "121.43.0.0/24"       # 阿里云杭州
    "121.43.1.0/24"       # 阿里云杭州
    "121.196.0.0/24"      # 阿里云杭州
    "121.196.1.0/24"      # 阿里云杭州
    "121.197.0.0/24"      # 阿里云杭州
    "121.197.1.0/24"      # 阿里云杭州
    "121.198.0.0/24"      # 阿里云杭州
    "121.198.1.0/24"      # 阿里云杭州
    "121.199.0.0/24"      # 阿里云杭州
    "121.199.1.0/24"      # 阿里云杭州
    "118.31.0.0/24"       # 阿里云杭州
    "118.31.1.0/24"       # 阿里云杭州
    "116.62.0.0/24"       # 阿里云杭州
    "116.62.1.0/24"       # 阿里云杭州
    "47.96.0.0/24"        # 阿里云杭州
    "47.96.1.0/24"        # 阿里云杭州
    "47.97.0.0/24"        # 阿里云杭州
    "47.97.1.0/24"        # 阿里云杭州
    "47.98.0.0/24"        # 阿里云杭州
    "47.98.1.0/24"        # 阿里云杭州
    "47.99.0.0/24"        # 阿里云杭州
    "47.99.1.0/24"        # 阿里云杭州
    
    # --- 南京 IDC ---
    "58.213.0.0/24"       # 南京电信 IDC
    "58.213.1.0/24"       # 南京电信 IDC
    "58.214.0.0/24"       # 南京电信 IDC
    "58.214.1.0/24"       # 南京电信 IDC
    "58.215.0.0/24"       # 南京电信 IDC
    "58.215.1.0/24"       # 南京电信 IDC
    "180.97.0.0/24"       # 南京电信 IDC
    "180.97.1.0/24"       # 南京电信 IDC
    
    # --- 成都 IDC ---
    "182.140.0.0/24"      # 成都电信 IDC
    "182.140.1.0/24"      # 成都电信 IDC
    "118.112.0.0/24"      # 成都电信 IDC
    "118.112.1.0/24"      # 成都电信 IDC
    "125.64.0.0/24"       # 成都电信 IDC
    "125.64.1.0/24"       # 成都电信 IDC
    "125.65.0.0/24"       # 成都电信 IDC
    "125.65.1.0/24"       # 成都电信 IDC
    "118.123.0.0/24"      # 成都电信 IDC
    "118.123.1.0/24"      # 成都电信 IDC
    
    # --- 武汉 IDC ---
    "202.103.0.0/24"      # 武汉电信 IDC
    "202.103.1.0/24"      # 武汉电信 IDC
    "58.48.0.0/24"        # 武汉电信 IDC
    "58.48.1.0/24"        # 武汉电信 IDC
    "58.49.0.0/24"        # 武汉电信 IDC
    "58.49.1.0/24"        # 武汉电信 IDC
    "111.47.0.0/24"       # 武汉移动 IDC
    "111.47.1.0/24"       # 武汉移动 IDC
    
    # --- 天津 IDC ---
    "60.29.0.0/24"        # 天津联通 IDC
    "60.29.1.0/24"        # 天津联通 IDC
    "60.28.0.0/24"        # 天津联通 IDC
    "60.28.1.0/24"        # 天津联通 IDC
    "117.9.0.0/24"        # 天津电信 IDC
    "117.9.1.0/24"        # 天津电信 IDC
    
    # --- 西安 IDC ---
    "113.200.0.0/24"      # 西安电信 IDC
    "113.200.1.0/24"      # 西安电信 IDC
    "117.34.0.0/24"       # 西安电信 IDC
    "117.34.1.0/24"       # 西安电信 IDC
    "117.35.0.0/24"       # 西安电信 IDC
    "117.35.1.0/24"       # 西安电信 IDC
    
    # --- 重庆 IDC ---
    "113.204.0.0/24"      # 重庆电信 IDC
    "113.204.1.0/24"      # 重庆电信 IDC
    "119.84.0.0/24"       # 重庆电信 IDC
    "119.84.1.0/24"       # 重庆电信 IDC
    "113.207.0.0/24"      # 重庆移动 IDC
    "113.207.1.0/24"      # 重庆移动 IDC
    
    # --- 郑州 IDC ---
    "182.118.0.0/24"      # 郑州联通 IDC
    "182.118.1.0/24"      # 郑州联通 IDC
    "115.60.0.0/24"       # 郑州电信 IDC
    "115.60.1.0/24"       # 郑州电信 IDC
    "123.6.0.0/24"        # 郑州电信 IDC
    "123.6.1.0/24"        # 郑州电信 IDC
    
    # --- 长沙 IDC ---
    "58.20.0.0/24"        # 长沙电信 IDC
    "58.20.1.0/24"        # 长沙电信 IDC
    "175.0.0.0/24"        # 长沙电信 IDC
    "175.0.1.0/24"        # 长沙电信 IDC
    "222.240.0.0/24"      # 长沙电信 IDC
    "222.240.1.0/24"      # 长沙电信 IDC
    
    # --- 青岛/济南 IDC ---
    "112.224.0.0/24"      # 青岛联通 IDC
    "112.224.1.0/24"      # 青岛联通 IDC
    "119.167.0.0/24"      # 济南联通 IDC
    "119.167.1.0/24"      # 济南联通 IDC
    "122.4.0.0/24"        # 济南联通 IDC
    "122.4.1.0/24"        # 济南联通 IDC
    "144.123.0.0/24"      # 青岛电信 IDC
    "144.123.1.0/24"      # 青岛电信 IDC
    
    # --- 福州/厦门 IDC ---
    "110.80.0.0/24"       # 福州电信 IDC
    "110.80.1.0/24"       # 福州电信 IDC
    "117.27.0.0/24"       # 福州电信 IDC
    "117.27.1.0/24"       # 福州电信 IDC
    "120.35.0.0/24"       # 福州电信 IDC
    "120.35.1.0/24"       # 福州电信 IDC
    "112.111.0.0/24"      # 厦门电信 IDC
    "112.111.1.0/24"      # 厦门电信 IDC
    
    # --- 沈阳/大连 IDC ---
    "218.25.0.0/24"       # 沈阳联通 IDC
    "218.25.1.0/24"       # 沈阳联通 IDC
    "222.163.0.0/24"      # 大连联通 IDC
    "222.163.1.0/24"      # 大连联通 IDC
    "116.212.0.0/24"      # 沈阳电信 IDC
    "116.212.1.0/24"      # 沈阳电信 IDC
    
    # --- 哈尔滨 IDC ---
    "222.171.0.0/24"      # 哈尔滨联通 IDC
    "222.171.1.0/24"      # 哈尔滨联通 IDC
    "221.208.0.0/24"      # 哈尔滨联通 IDC
    "221.208.1.0/24"      # 哈尔滨联通 IDC
    
    # --- 石家庄 IDC ---
    "121.28.0.0/24"       # 石家庄电信 IDC
    "121.28.1.0/24"       # 石家庄电信 IDC
    "110.249.0.0/24"      # 石家庄电信 IDC
    "110.249.1.0/24"      # 石家庄电信 IDC
    
    # --- 太原 IDC ---
    "60.220.0.0/24"       # 太原联通 IDC
    "60.220.1.0/24"       # 太原联通 IDC
    "60.221.0.0/24"       # 太原联通 IDC
    "60.221.1.0/24"       # 太原联通 IDC
    
    # --- 合肥 IDC ---
    "114.104.0.0/24"      # 合肥电信 IDC
    "114.104.1.0/24"      # 合肥电信 IDC
    "60.173.0.0/24"       # 合肥电信 IDC
    "60.173.1.0/24"       # 合肥电信 IDC
    
    # --- 南昌 IDC ---
    "59.53.0.0/24"        # 南昌电信 IDC
    "59.53.1.0/24"        # 南昌电信 IDC
    "171.80.0.0/24"       # 南昌电信 IDC
    "171.80.1.0/24"       # 南昌电信 IDC
    
    # --- 昆明 IDC ---
    "222.172.0.0/24"      # 昆明电信 IDC
    "222.172.1.0/24"      # 昆明电信 IDC
    "116.52.0.0/24"       # 昆明电信 IDC
    "116.52.1.0/24"       # 昆明电信 IDC
    
    # --- 贵阳 IDC ---
    "117.135.0.0/24"      # 贵阳移动 IDC
    "117.135.1.0/24"      # 贵阳移动 IDC
    "221.13.0.0/24"       # 贵阳电信 IDC
    "221.13.1.0/24"       # 贵阳电信 IDC
    
    # --- 兰州 IDC ---
    "122.143.0.0/24"      # 兰州电信 IDC
    "122.143.1.0/24"      # 兰州电信 IDC
    "218.95.0.0/24"       # 兰州电信 IDC
    "218.95.1.0/24"       # 兰州电信 IDC
    
    # --- 乌鲁木齐 IDC ---
    "124.88.0.0/24"       # 乌鲁木齐电信 IDC
    "124.88.1.0/24"       # 乌鲁木齐电信 IDC
    "222.82.0.0/24"       # 乌鲁木齐电信 IDC
    "222.82.1.0/24"       # 乌鲁木齐电信 IDC
    
    # --- 呼和浩特 IDC ---
    "1.24.0.0/24"         # 呼和浩特电信 IDC
    "1.24.1.0/24"         # 呼和浩特电信 IDC
    "116.117.0.0/24"      # 呼和浩特电信 IDC
    "116.117.1.0/24"      # 呼和浩特电信 IDC
    
    # --- 国内云服务商常见攻击段 ---
    "42.193.0.0/24"       # 腾讯云
    "42.193.1.0/24"       # 腾讯云
    "42.193.5.0/24"       # 腾讯云（高频攻击）
    "42.193.38.0/24"      # 腾讯云（高频攻击）
    "43.137.74.0/24"      # 腾讯云（高频攻击）
    "43.153.241.0/24"     # 腾讯云（高频攻击）
    "43.153.244.0/24"     # 腾讯云（高频攻击）
    "101.32.239.0/24"     # 腾讯云（高频攻击）
    "101.32.242.0/24"     # 腾讯云（高频攻击）
    "14.128.63.0/24"      # 国内 IDC（高频攻击）
    "103.149.200.0/24"    # 国内 IDC（高频攻击）
    
    # ========== 从服务器日志提取的高频攻击源（精确C段）==========
    # 以下是从您服务器 netstat 输出中多次出现的攻击IP
    
    # --- 江苏电信/联通 IDC（持续攻击）---
    "61.155.157.0/24"     # 持续高频（61.155.157.4/8/13/16/19/28/52/54等）
    "49.7.227.0/24"       # 高频攻击源
    
    # --- 上海电信 IDC ---
    "101.89.87.0/24"      # 持续高频（101.89.87.44等）
    
    # --- 河北 IDC ---
    "111.29.85.0/24"      # 高频（111.29.85.170）
    "183.197.244.0/24"    # 高频攻击
    
    # --- 浙江电信 IDC ---
    "115.231.78.0/24"     # 持续攻击（115.231.78.4）
    
    # --- 腾讯云（高频攻击段）---
    "42.193.38.0/24"      # 高频（42.193.38.228）
    "42.193.5.0/24"       # 高频（42.193.5.156）
    "43.137.74.0/24"      # 高频（43.137.74.4/252）
    "43.153.241.0/24"     # 高频（43.153.241.54）
    "43.153.244.0/24"     # 高频（43.153.244.5）
    "101.32.239.0/24"     # 高频（101.32.239.31）
    "101.32.242.0/24"     # 高频（101.32.242.117）
    
    # --- 俄罗斯/东欧 IDC ---
    "188.143.244.0/24"    # 高频攻击（188.143.244.141）
    "176.65.148.0/24"     # 高频攻击（176.65.148.178）
    "195.242.212.0/24"    # 高频攻击（195.242.212.182）
    "141.98.11.0/24"      # 高频攻击（141.98.11.181）
    "89.187.178.0/24"     # 高频攻击
    
    # --- Facebook 爬虫（精确段）---
    "173.252.70.0/24"     # Facebook（持续高频）
    "173.252.82.0/24"     # Facebook
    "173.252.87.0/24"     # Facebook
    
    # --- DigitalOcean（高频攻击段）---
    "159.223.198.0/24"    # 高频攻击
    "138.197.167.0/24"    # 高频攻击
    "134.122.133.0/24"    # 高频攻击
    
    # --- Censys/安全扫描 ---
    "167.94.146.0/24"     # Censys 扫描
    "167.94.138.0/24"     # Censys 扫描
    
    # --- 其他高频攻击源 ---
    "204.101.161.0/24"    # 高频攻击（204.101.161.15）
    "136.119.129.0/24"    # 高频攻击（136.119.129.236）
    "104.192.108.0/24"    # 高频攻击
    "66.29.128.0/24"      # 高频攻击
    "216.26.231.0/24"     # 高频攻击
    "203.2.64.0/24"       # 高频攻击
    "116.196.81.0/24"     # 高频攻击
    "74.7.241.0/24"       # 高频攻击
    "74.7.230.0/24"       # 高频攻击
    "206.168.34.0/24"     # 高频攻击
    "165.154.231.0/24"    # 高频攻击
    "51.68.111.0/24"      # OVH 攻击源
    
    # --- 安徽/江西 IDC ---
    "223.244.35.0/24"     # 高频攻击
    "36.56.208.0/24"      # 高频攻击
    "59.55.229.0/24"      # 高频攻击
    "221.7.192.0/24"      # 高频攻击（221.7.192.106）
    
    # --- 广东 IDC ---
    "113.95.140.0/24"     # 高频攻击（113.95.140.179）
    "113.95.132.0/24"     # 高频攻击（113.95.132.111）
    "119.125.127.0/24"    # 高频攻击
    "112.96.110.0/24"     # 高频攻击（112.96.110.226）
    
    # --- 河南/湖北 IDC ---
    "42.243.152.0/24"     # 高频攻击
    "110.166.71.0/24"     # 高频攻击
    "111.172.35.0/24"     # 高频攻击
    
    # --- 山东联通 IDC ---
    "27.124.12.0/24"      # 高频攻击（27.124.12.3）
    "39.128.15.0/24"      # 高频攻击
    
    # --- 南京电信 IDC ---
    "180.110.203.0/24"    # 高频攻击（180.110.203.108）
    
    # --- Azure/微软（精确攻击段）---
    "172.190.142.0/24"    # Azure 高频攻击（172.190.142.176）
    "4.197.195.0/24"      # Azure 高频攻击
    "4.194.84.0/24"       # Azure 高频攻击
    
    # --- Google Cloud（精确攻击段）---
    "34.72.176.0/24"      # GCP 高频攻击
    "35.192.0.0/24"       # GCP
    "35.193.0.0/24"       # GCP
    
    # --- 伊朗/中东 ---
    "151.240.205.0/24"    # 伊朗攻击源
    
    # --- 其他国内 IDC ---
    "1.71.140.0/24"       # 高频攻击
    "1.116.190.0/24"      # 高频攻击
    "49.65.18.0/24"       # 高频攻击
    "117.62.235.0/24"     # 高频攻击
    "125.114.151.0/24"    # 高频攻击
    
    # ========== 2024-12-10 新增攻击源（精确C段）==========
    
    # --- 广东电信 IDC（集中攻击）---
    "183.7.151.0/24"      # 高频攻击（183.7.151.240）
    "113.95.133.0/24"     # 高频攻击（113.95.133.178）
    "113.95.143.0/24"     # 高频攻击（113.95.143.204）
    "27.46.69.0/24"       # 高频攻击（27.46.69.16/6/15/11）
    "27.46.125.0/24"      # 高频攻击（27.46.125.33/28）
    "27.46.75.0/24"       # 高频攻击（27.46.75.2/4）
    "183.10.99.0/24"      # 高频攻击（183.10.99.251）
    "125.94.173.0/24"     # 高频攻击（125.94.173.221）
    "125.94.175.0/24"     # 高频攻击（125.94.175.117）
    
    # --- 广东移动 IDC ---
    "112.121.183.0/24"    # 高频攻击（112.121.183.70）
    
    # --- 微软 Azure ---
    "172.192.13.0/24"     # 高频攻击（172.192.13.142）
    
    # --- DigitalOcean（B段封禁）---
    "24.144.0.0/16"       # DigitalOcean
    "167.99.0.0/16"       # DigitalOcean
    "164.92.0.0/16"       # DigitalOcean
    "146.190.0.0/16"      # DigitalOcean
    "143.198.0.0/16"      # DigitalOcean
    "137.184.0.0/16"      # DigitalOcean
    
    # ========== 2024-12-10 新增攻击源（第二批）==========
    
    # --- 浙江电信 IDC ---
    "183.131.196.0/24"    # 高频攻击（183.131.196.11/154）
    "60.190.242.0/24"     # 高频攻击（60.190.242.26）
    
    # --- 贵州电信 IDC ---
    "222.85.202.0/24"     # 高频攻击（222.85.202.74）
    
    # --- 湖北电信 IDC ---
    "111.172.7.0/24"      # 高频攻击（111.172.7.1）
    
    # --- 北京联通 IDC ---
    "111.196.127.0/24"    # 高频攻击（111.196.127.188）
    
    # --- 广东电信 IDC（新增C段）---
    "183.7.150.0/24"      # 高频攻击（183.7.150.188）
    
    # --- 广东移动 IDC ---
    "120.240.178.0/24"    # 高频攻击（120.240.178.177/241）
    
    # --- 山东联通 IDC ---
    "27.124.32.0/24"      # 高频攻击（27.124.32.52）
    "58.56.120.0/24"      # 高频攻击（58.56.120.170）
    
    # --- 福建电信 IDC ---
    "120.43.93.0/24"      # 高频攻击（120.43.93.40）
    
    # --- 河南移动 IDC ---
    "111.7.100.0/24"      # 高频攻击（111.7.100.27）
    
    # --- 阿里云 ---
    "123.59.186.0/24"     # 高频攻击（123.59.186.219）
    "123.57.136.0/24"     # 高频攻击（123.57.136.91）
    
    # --- Zenlayer 香港（B段封禁）---
    "143.92.0.0/16"       # Zenlayer 香港
    
    # --- 印尼 IDC（B段封禁）---
    "43.252.0.0/16"       # 印尼 IDC
    
    # --- 美国 IDC（B段封禁）---
    "192.253.0.0/16"      # 美国 IDC
    "216.73.0.0/16"       # 美国 IDC
    "107.173.0.0/16"      # ColoCrossing 美国 IDC
    "64.226.0.0/16"       # DigitalOcean
    
    # --- 韩国 IDC（B段封禁）---
    "27.102.0.0/16"       # 韩国 IDC
    
    # --- 南美 IDC（B段封禁）---
    "191.102.0.0/16"      # 哥伦比亚 IDC
    
    # --- 江苏 IDC（C段封禁）---
    "112.2.149.0/24"      # 江苏移动 IDC
    "49.72.25.0/24"       # 江苏电信 IDC
    
    # --- 安徽电信 IDC（C段封禁）---
    "114.99.247.0/24"     # 安徽电信 IDC
    "113.215.188.0/24"
    "113.215.189.0/24"
)

# 封禁 IP 段
block_range() {
    local range=$1
    if iptables -C INPUT -s "$range" -j DROP 2>/dev/null; then
        echo -e "${YELLOW}[跳过]${NC} $range 已经被封禁"
    else
        iptables -I INPUT -s "$range" -j DROP
        echo -e "${GREEN}[封禁]${NC} $range"
    fi
}

echo ""
echo -e "${RED}警告: 即将封禁 ${#BLOCK_RANGES[@]} 个 IP 段！${NC}"
echo -e "${YELLOW}此版本已移除中国家庭宽带IP段，只封禁云服务商/IDC${NC}"
echo ""
echo -e "${GREEN}白名单 IP（${#WHITELIST_IPS[@]} 个）：${NC}"
for ip in "${WHITELIST_IPS[@]}"; do
    echo "  - $ip"
done
echo ""
echo -e "${YELLOW}提示：如果你使用VPN登录服务器，请先在脚本开头的 WHITELIST_IPS 数组中添加VPN IP${NC}"
echo ""
read -p "确认执行？(y/n): " confirm

if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
    echo "已取消"
    exit 0
fi

echo ""
echo "=========================================="
echo "第一步：添加白名单..."
echo "=========================================="

for ip in "${WHITELIST_IPS[@]}"; do
    if iptables -C INPUT -s "$ip" -j ACCEPT 2>/dev/null; then
        echo -e "${YELLOW}[跳过]${NC} $ip 已在白名单"
    else
        iptables -I INPUT 1 -s "$ip" -j ACCEPT
        echo -e "${GREEN}[白名单]${NC} $ip"
    fi
done

echo ""
echo "=========================================="
echo "第二步：封禁恶意IP段..."
echo "=========================================="

for range in "${BLOCK_RANGES[@]}"; do
    block_range "$range"
done

echo ""
echo "=========================================="
echo -e "${GREEN}封禁完成！${NC}"
echo "=========================================="

echo ""
echo "当前 iptables DROP 规则数量："
iptables -L INPUT -n | grep DROP | wc -l

echo ""
echo "当前连接状态："
netstat -an | grep -E ':80|:443' | awk '{print $6}' | sort | uniq -c

echo ""
echo "当前负载："
uptime

echo ""
echo "=========================================="
echo "第三步：持久化规则..."
echo "=========================================="

# 保存 iptables 规则
iptables-save > /etc/sysconfig/iptables
echo -e "${GREEN}[完成]${NC} 规则已保存到 /etc/sysconfig/iptables"

# 创建开机自动加载脚本
RCLOCAL="/etc/rc.d/rc.local"
LOAD_CMD="/sbin/iptables-restore < /etc/sysconfig/iptables"

# 检查 rc.local 是否存在，不存在则创建
if [[ ! -f "$RCLOCAL" ]]; then
    echo '#!/bin/bash' > "$RCLOCAL"
fi

# 确保 rc.local 有执行权限
chmod +x "$RCLOCAL"

# 检查是否已添加 iptables-restore 命令
if ! grep -q "iptables-restore" "$RCLOCAL" 2>/dev/null; then
    echo "$LOAD_CMD" >> "$RCLOCAL"
    echo -e "${GREEN}[完成]${NC} 已添加开机自动加载规则到 $RCLOCAL"
else
    echo -e "${YELLOW}[跳过]${NC} 开机自动加载已配置"
fi

# 显示当前保存的规则数量
SAVED_RULES=$(wc -l < /etc/sysconfig/iptables)
echo -e "${GREEN}[完成]${NC} 共保存 $SAVED_RULES 行规则"

echo ""
echo "=========================================="
echo -e "${GREEN}全部完成！${NC}"
echo "=========================================="
echo ""
echo "持久化状态："
echo "  - 规则文件: /etc/sysconfig/iptables ($SAVED_RULES 行)"
echo "  - 开机加载: $RCLOCAL"
echo ""
echo "服务器重启后规则会自动生效！"
echo "=========================================="
